{{>layout/compheader}}

<!-- 메인 -->
<!-- 각자 페이지 main 클래스에 name 작성-->
<!-- main 클래스에 background-color를 넣을거면 class="common_bg" 넣어주기 -->
<main class="emp_info main_page">
  <div class="container">
    <!-- container 건들지 말기 -->
    <!-- 여기서부터 시작 -->
    <div class="position_box">
      <div class="position_tab">
        <ul class="position_category" id="position">
          <li>
            <a href="#" class="" onclick="handleAllClick()">전체</a>
          </li>
          {{#positionList}}
          <li>
            <a href="#" class="skill_box" onclick="handlePositionClick('{{id}}')">{{position}}</a>
          </li>
          {{/positionList}}
        </ul>
      </div>
      <ul class="position_menu">
        {{#skillList}}
        <li class="position_skill com_skill">
          <a href="#" class="skill_box" onclick="handleSkillClick('{{id}}')">{{skill}}</a>
        </li>
        {{/skillList}}
      </ul>
    </div>



    <div class="position_select">
      <select class="select select_edu" id="career">
        <option disabled selected>경력</option>
        <option value="신입">신입</option>
        <option value="경력 1년차">1년차</option>
        <option value="경력 2년차">2년차</option>
        <option value="경력 3년차">3년차</option>
        <option value="경력 4년차">4년차</option>
        <option value="경력 5년차">5년차</option>
      </select>

      <select class="select select_adr" id="location">
        <option disabled selected>지역</option>
        <option value="서울">서울</option>
        <option value="경기">경기</option>
        <option value="인천">인천</option>
        <option value="부산">부산</option>
        <option value="대구">대구</option>
        <option value="광주">광주</option>
        <option value="대전">대전</option>
        <option value="울산">울산</option>
        <option value="세종">세종</option>
        <option value="충북">충북</option>
        <option value="충남">충남</option>
        <option value="전북">전북</option>
        <option value="전남">전남</option>
        <option value="경북">경북</option>
        <option value="경남">경남</option>
        <option value="제주">제주</option>
      </select>
    </div>
    <div class="main_box" id="position-box">

    </div>
  </div>


  <script>

    render(null, 'all');

    // 페이지 로드 시 초기 데이터를 불러옵니다.
    // loadInitialData();

    function handleAllClick() {
      render(null, 'all');
    }

    function handlePositionClick(positionId) {
      render(positionId, 'position');
    }

    function handleSkillClick(skillId) {
      render(skillId, 'skill');
    }

    // 2. 통신해서 화면 다시 리기
    async function render(id, type) {
      $("#position-box").html('');
      let responseBody = await download(id, type);
      responseBody.forEach((jobOpening) => {
        $("#position-box").append(jobOpeningBox(jobOpening));
      });
    }

    $("#career, #location").change(async function () {
      let careerValue = $("#career").val(); // $(this)를 사용하여 현재 선택한 요소를 참조합니다.
      let locationValue = $("#location").val();
      await render2(careerValue, locationValue);
    });

    async function render2(career, location) {
      $("#position-box").html('');
      let responseBody = await download02(career, location);
      responseBody.forEach((jobOpening2) => {
        $("#position-box").append(jobOpeningBox(jobOpening2));
      });
    }
    console.log("화면 그리기")

    // 3. 컴퍼넌트
    function jobOpeningBox(jobOpening) {
      return `
        <li class="comp_item">
          <a href="/user/jobOpening/${jobOpening.jobOpeningId}">
            <ul class="comp_cont">
              <li class="comp_img">
                <img src="/image/company_img/comp_img01.png" alt="기업01">
              </li>
              <li class="com_name">
                ${jobOpening.compName}
              </li>
              <li class="com_tit">
                <h4>${jobOpening.title}</h4>
              </li>
              <li class="com_txt">
                <p>${jobOpening.skill}</p>
              </li>
              <li class="com_etc">
                <span class="com_adr">
                  <p class="compaddress">${jobOpening.compAddress}</p>
                  <p>|</p>
                </span>
                <span class="com_car">
                  <p class="career">${jobOpening.career}</p>
                </span>
              </li>
            </ul>
          </a>
        </li>`;
    }


    console.log("html 결합");

    // 4. 통신코드
    async function download(id, type) {
      let response = await fetch(`/api/jobOpening/select/${type}?${type}Id=${id}`);
      let responseBody = await response.json();
      console.log(responseBody);
      return responseBody;
    }

    async function download02(career, location) {
      let response = await fetch("/api/jobOpening/select/career?career=" + career + "&location=" + location);
      let responseBody = await response.json();
      return responseBody;
    }
  </script>

</main>
<!-- 메인 -->

{{>layout/footer}}